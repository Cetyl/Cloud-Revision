#  Access RDS via EC2 Jumphost Using 127.0.0.1

## Overview
This guide explains how to:
- Connect to an RDS MySQL instance through an EC2 jumphost using `127.0.0.1`.
- Create a local SSH tunnel inside the EC2 instance.
- Make the tunnel permanent using `systemd`.
- Roll back all changes if you no longer want the tunnel.

---

## 1. One-time Sanity Check – Verify EC2 Can Reach RDS

SSH into EC2:
```bash
ssh -i /path/to/key.pem ec2-user@<EC2_PUBLIC_IP>
```

From EC2, test DB connectivity:
```bash
mysql -h Endpoint -u user -p
```
If this works, EC2 can reach the RDS.

---

## 2. Temporary Tunnel (Manual Method)

On the EC2 instance:
```bash
ssh -N -L 3306:Endpoint:3306 localhost
```

- `-N`: No remote command, just tunnel.
- `-L`: Local port forwarding (format: local_port:remote_host:remote_port).

Keep this open in a terminal.  
In another EC2 terminal:
```bash
mysql -h 127.0.0.1 -u username -p
```

When you close the tunnel process, `127.0.0.1` connections will stop working.

---

## 3. Making It Permanent with systemd

### Step 3.1 – Create systemd Service
```bash
sudo nano /etc/systemd/system/mysql-tunnel.service
```

Paste:
```ini
[Unit]
Description=MySQL SSH Tunnel to RDS
After=network.target

[Service]
User=ec2-user
ExecStart=/usr/bin/ssh -N -L 3306:Endpoint:3306 localhost
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

### Step 3.2 – Enable and Start the Service
```bash
sudo systemctl daemon-reload
sudo systemctl enable mysql-tunnel
sudo systemctl start mysql-tunnel
```

Now the tunnel runs automatically on boot.  
You can connect anytime via:
```bash
mysql -h 127.0.0.1 -u user -p
```

---

## 4. Optional – Spoof RDS Hostname to 127.0.0.1

```bash
sudo sh -c "echo '127.0.0.1 endpoint' >> /etc/hosts"
```

Now this also works:
```bash
mysql -h endpoint -u user -p
```

---

## 5. Rollback / Remove Changes

1. Stop & disable systemd service:
```bash
sudo systemctl stop mysql-tunnel
sudo systemctl disable mysql-tunnel
sudo rm /etc/systemd/system/mysql-tunnel.service
sudo systemctl daemon-reload
```

2. Remove `/etc/hosts` entry (if added):
```bash
sudo sed -i '/endpoint/d' /etc/hosts
```

3. Manual tunnel: Just stop the SSH process (Ctrl+C).

---

## Notes
- If the RDS endpoint changes, update the tunnel command and `/etc/hosts` if used.
- Ensure EC2’s security group allows outbound MySQL traffic to RDS.
- systemd ensures the tunnel restarts if it drops.

---


