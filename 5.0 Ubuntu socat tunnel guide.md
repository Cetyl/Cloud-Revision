

# MySQL RDS Access via Socat Tunnel (Ubuntu EC2)

This guide shows how to set up a `socat` TCP tunnel from an Ubuntu EC2 instance to an AWS RDS MySQL instance, and make it persistent with `systemd`.

---

## 1. Install socat
```bash
sudo apt-get update
sudo apt-get install socat -y
````

---

## 2. Check if local port 3306 is free

```bash
sudo lsof -i:3306
```

* If **no output**, port is free.
* If it’s taken (e.g., MySQL already running), choose another port like `13306`.

---

## 3. Test the tunnel manually

Replace `<RDS-ENDPOINT>` with your actual RDS host:

```bash
socat TCP-LISTEN:3306,fork TCP:<RDS-ENDPOINT>:3306 &
```

### Explanation:

* TCP-LISTEN:3306 → Listen locally on port 3306.

* fork → Handle multiple incoming connections.

* TCP:<rds-endpoint>:3306 → Forward traffic to your RDS instance.

* & → Runs in background so you keep your shell free.



Test the connection:

```bash
mysql -h 127.0.0.1 -u user -p
```

---

## 4. Create a systemd service (make it permanent)

Create the service file:

```bash
sudo nano /etc/systemd/system/socat-rds.service
```

Paste:

```ini
[Unit]
Description=Socat Tunnel to RDS MySQL
After=network.target

[Service]
ExecStart=/usr/bin/socat TCP-LISTEN:3306,fork TCP:Endpoint:3306 
Restart=always
User=ubuntu

[Install]
WantedBy=multi-user.target
```

Save (`CTRL+O`), exit (`CTRL+X`).

---

## 5. Enable & start the tunnel

```bash
sudo systemctl daemon-reload
sudo systemctl enable socat-rds
sudo systemctl start socat-rds
```

Check status:

```bash
sudo systemctl status socat-rds
```

---

## 6. Rollback / Stop

To stop & remove the tunnel:

```bash
sudo systemctl stop socat-rds
sudo systemctl disable socat-rds
sudo rm /etc/systemd/system/socat-rds.service
sudo systemctl daemon-reload
```

If started manually, stop it with:

```bash
pkill socat
```

---

## 7. Security notes

* Limit inbound port 3306 in the EC2 security group to **your IP only**.
* Avoid exposing this tunnel to the public internet.
* Use a **non-3306 local port** if MySQL runs on EC2 to avoid conflicts.

---

## ✅ Final test

Once set up:

```bash
mysql -h 127.0.0.1 -u user -p
```











---

If you want, I can also make a **dual-port rollback plan** so that you can quickly switch between **socat** and **no tunnel** without deleting the service — just start/stop with one command.  

Do you want me to add that quick-toggle method?
```
